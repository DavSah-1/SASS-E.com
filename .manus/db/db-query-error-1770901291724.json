{
  "query": "\n-- Create enum types for quota_usage\nDO $$ BEGIN\n  CREATE TYPE service AS ENUM ('tavily', 'whisper', 'llm');\nEXCEPTION\n  WHEN duplicate_object THEN null;\nEND $$;\n\nDO $$ BEGIN\n  CREATE TYPE quota_tier AS ENUM ('free', 'starter', 'pro', 'ultimate');\nEXCEPTION\n  WHEN duplicate_object THEN null;\nEND $$;\n\n-- Create quota_usage table\nCREATE TABLE IF NOT EXISTS quota_usage (\n  id SERIAL PRIMARY KEY,\n  user_id TEXT NOT NULL REFERENCES users(id),\n  service service NOT NULL,\n  count INTEGER DEFAULT 0 NOT NULL,\n  period VARCHAR(7) NOT NULL,\n  tier quota_tier NOT NULL,\n  reset_at TIMESTAMP NOT NULL,\n  created_at TIMESTAMP DEFAULT NOW() NOT NULL,\n  updated_at TIMESTAMP DEFAULT NOW() NOT NULL\n);\n\n-- Create index on user_id and period for fast lookups\nCREATE INDEX IF NOT EXISTS idx_quota_usage_user_period ON quota_usage(user_id, period, service);\n\n-- Enable RLS\nALTER TABLE quota_usage ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies\nDROP POLICY IF EXISTS user_view_own_quota ON quota_usage;\nCREATE POLICY user_view_own_quota ON quota_usage\n  FOR SELECT\n  USING (user_id = auth.uid());\n\nDROP POLICY IF EXISTS user_insert_own_quota ON quota_usage;\nCREATE POLICY user_insert_own_quota ON quota_usage\n  FOR INSERT\n  WITH CHECK (user_id = auth.uid());\n\nDROP POLICY IF EXISTS user_update_own_quota ON quota_usage;\nCREATE POLICY user_update_own_quota ON quota_usage\n  FOR UPDATE\n  USING (user_id = auth.uid())\n  WITH CHECK (user_id = auth.uid());\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 3nggiiWQDu5Xrc9.root --database 8mC6ZNEwokHKmKSGT6E4hn --execute \n-- Create enum types for quota_usage\nDO $$ BEGIN\n  CREATE TYPE service AS ENUM ('tavily', 'whisper', 'llm');\nEXCEPTION\n  WHEN duplicate_object THEN null;\nEND $$;\n\nDO $$ BEGIN\n  CREATE TYPE quota_tier AS ENUM ('free', 'starter', 'pro', 'ultimate');\nEXCEPTION\n  WHEN duplicate_object THEN null;\nEND $$;\n\n-- Create quota_usage table\nCREATE TABLE IF NOT EXISTS quota_usage (\n  id SERIAL PRIMARY KEY,\n  user_id TEXT NOT NULL REFERENCES users(id),\n  service service NOT NULL,\n  count INTEGER DEFAULT 0 NOT NULL,\n  period VARCHAR(7) NOT NULL,\n  tier quota_tier NOT NULL,\n  reset_at TIMESTAMP NOT NULL,\n  created_at TIMESTAMP DEFAULT NOW() NOT NULL,\n  updated_at TIMESTAMP DEFAULT NOW() NOT NULL\n);\n\n-- Create index on user_id and period for fast lookups\nCREATE INDEX IF NOT EXISTS idx_quota_usage_user_period ON quota_usage(user_id, period, service);\n\n-- Enable RLS\nALTER TABLE quota_usage ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies\nDROP POLICY IF EXISTS user_view_own_quota ON quota_usage;\nCREATE POLICY user_view_own_quota ON quota_usage\n  FOR SELECT\n  USING (user_id = auth.uid());\n\nDROP POLICY IF EXISTS user_insert_own_quota ON quota_usage;\nCREATE POLICY user_insert_own_quota ON quota_usage\n  FOR INSERT\n  WITH CHECK (user_id = auth.uid());\n\nDROP POLICY IF EXISTS user_update_own_quota ON quota_usage;\nCREATE POLICY user_update_own_quota ON quota_usage\n  FOR UPDATE\n  USING (user_id = auth.uid())\n  WITH CHECK (user_id = auth.uid());\n",
  "returncode": 1,
  "logs": [
    "ERROR 1064 (42000) at line 3: You have an error in your SQL syntax; check the manual that corresponds to your TiDB version for the right syntax to use line 1 column 11 near \"BEGIN",
    "  CREATE TYPE service AS ENUM ('tavily', 'whisper', 'llm')\""
  ]
}